<!DOCTYPE html>
<html lang="pt-br">
<head>

<meta charset="UTF-8">
<title>Livros Emprestados</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>

body{
background:#f4f6f9;
font-family:Segoe UI;
}

.menu{
height:100vh;
width:240px;
background:#8B0000;
position:fixed;
left:-240px;
top:0;
transition:0.3s;
padding-top:20px;
}

.menu a{
display:block;
color:white;
text-decoration:none;
padding:18px;
font-size:18px;
}

.menu a:hover{
background:#a00000;
}

.menu.active{
left:0;
}

.abrir{
font-size:30px;
cursor:pointer;
color:#8B0000;
}

.card{
padding:25px;
border-radius:10px;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
background:white;
}

img{
border-radius:5px;
}

.atrasado{
background:#ffd6d6;
}

button{
font-size:14px;
}

</style>

</head>

<body>

<div class="container mt-4">

<span class="abrir" onclick="abrirMenu()">‚ò∞</span>

<h2 class="mt-3">Livros Emprestados</h2>

<div class="card mt-3">

<table class="table table-striped align-middle">

<tr>

<th>Capa</th>
<th>Livro</th>
<th>Autor</th>
<th>G√™nero</th>
<th>Leitor</th>
<th>Data Empr√©stimo</th>
<th>Devolu√ß√£o</th>
<th>A√ß√£o</th>

</tr>

<tbody id="lista"></tbody>

</table>

</div>

</div>


<!-- MENU LATERAL -->

<div id="menu" class="menu">

<a href="javascript:void(0)" onclick="fecharMenu()">‚¨Ö Fechar</a>

<a href="index.html">üè† In√≠cio</a>

<a href="cadastrar_livro.html">üìö Cadastrar Livro</a>

<a href="cadastrar_leitor.html">üë§ Cadastrar Leitor</a>

<a href="emprestimo.html">üì¶ Empr√©stimo</a>

<a href="livros_emprestados.html">üìã Livros Emprestados</a>

</div>


<script>

function abrirMenu(){
document.getElementById("menu").classList.add("active")
}

function fecharMenu(){
document.getElementById("menu").classList.remove("active")
}


let emprestimos = JSON.parse(localStorage.getItem("emprestimos")) || []
let livros = JSON.parse(localStorage.getItem("livros")) || []

let hoje = new Date()


emprestimos.forEach((e,i)=>{

let dataDevolucao = new Date(e.devolucao)

let atrasado = dataDevolucao < hoje

lista.innerHTML+=`

<tr class="${atrasado ? 'atrasado' : ''}">

<td>
<img src="${e.capa}" width="60">
</td>

<td>${e.livro}</td>

<td>${e.autor || ""}</td>

<td>${e.genero || ""}</td>

<td>${e.leitor}</td>

<td>${e.data}</td>

<td>${e.devolucao}</td>

<td>

<button class="btn btn-success btn-sm"
onclick="devolver(${i})">

Devolver

</button>

</td>

</tr>

`

})


function devolver(i){

let emprestimo = emprestimos[i]

let livroIndex = livros.findIndex(l => l.titulo === emprestimo.livro)

if(livroIndex !== -1){

livros[livroIndex].disponivel = true

}

emprestimos.splice(i,1)

localStorage.setItem("emprestimos",JSON.stringify(emprestimos))
localStorage.setItem("livros",JSON.stringify(livros))

alert("Livro devolvido!")

location.reload()

}

</script>

</body>
</html>